ENSO对MJO垂直倾斜结构影响的研究
项目简介

本项目旨在研究 厄尔尼诺-南方涛动 (ENSO) 对 马登-朱利安振荡 (MJO) 垂直倾斜结构的影响。MJO 是热带大气中30-90天尺度的主要变率模态，表现为大型对流-环流系统沿赤道缓慢向东传播。ENSO 是年际尺度的气候模态，包括厄尔尼诺和拉尼娜位相，会通过改变大尺度环流和水汽分布影响MJO的活动。本研究希望通过分组对比分析，在不同ENSO背景下MJO对流的垂直结构倾斜特征是否存在系统差异，并探讨潜在的物理机制。

本项目使用 Python 3 在 antigravity 环境中编写和运行代码。我们将依次完成数据获取、预处理、事件识别、分组对比和机制诊断等步骤，最终评估ENSO背景对于MJO垂直倾斜结构的影响程度及其显著性。

数据与变量清单（含来源）

本研究需要以下数据集和变量（含来源）：

RMM指数 (实时多变量MJO指数)：每日RMM1和RMM2时间序列，用于识别MJO事件和位相。来源：澳大利亚气象局（Bureau of Meteorology）提供的Wheeler & Hendon方法RMM指数数据。

ONI/Niño3.4指数 (海洋尼诺指数)：逐月的Niño3.4区海表温度异常3个月滑动平均值，用于表征ENSO状态（El Niño或La Niña）。来源：NOAA气候预测中心 (CPC) 公布的ONI指数数据。

OLR数据 (向外长波辐射)：逐日OLR观测（单位 W/m²），作为深对流活动的代理变量，用于定位MJO对流中心。来源：NOAA提供的逐日OLR格点数据集。

再分析气象数据：逐日大气变量，包括各压力层的垂直速度ω (Pa/s)、比湿q、水平风场(u,v)、以及其它诊断所需量（如降水或径向流量等）。来源：ECMWF的ERA5再分析数据（或同等再分析数据集，如ERA-Interim），空间分辨率和时间覆盖满足1979年至今的分析需求。

其他派生变量：根据需要从以上基础数据计算，例如湿静能 (MSE) 及其平流项、边界层水汽汇损 (Q2) 等，用于机制分析。

数据下载与预处理

数据下载：按照上述清单从官方渠道获取数据。可以使用Python脚本或库自动下载：

RMM指数：通过HTTP请求下载RMM指数文本文件（例如 rmm.74toRealtime.txt），包含1974年至今每日的RMM1、RMM2及相位信息。

ONI指数：从NOAA CPC网站获取ONI时间序列表（可爬取网页或下载CSV），提取每月Niño3.4指数值。

OLR数据：下载NOAA逐日OLR网格数据（例如从NOAA/PSL提供的NetCDF文件，1979年至今覆盖全球OLR）。

再分析数据：使用ERA5数据API（如CDS API）根据需求提取研究区域和时段的变量。可下载全球或热带区域(比如20°S-20°N)的逐日网格数据，包括所需气压层的ω、q、u、v等。

数据预处理：下载后对数据进行清洗和变换：

时间对齐：将所有数据重采样或截取到共同时间范围（例如1979-01-01起），确保覆盖所有MJO事件时期。主要分析季节可聚焦在北半球冬季（11月至次年4月），因为此阶段MJO活跃且ENSO影响明显。

空间子域：提取感兴趣的区域（例如经度范围30°E-180°E，纬度15°S-15°N），专注于印度洋-西太平洋暖池一带的MJO活动核心区域。

异常计算：去除年周期气候态，对OLR和再分析变量计算逐日距平（相对于长期日历日气候平均），以提取季节内异常信号。必要时对大气字段应用20-90天带通滤波，以突出MJO尺度的变化。

格式统一：将数据存储为易于读取的格式（如NetCDF或Zarr）。使用 xarray 加载网格数据，使用 pandas 读取指数时间序列，并确保日期索引匹配。预处理阶段的输出包括经过滤波或标准化的OLR和大气变量异常，以及对应时间的RMM和ONI指数值。

MJO事件识别方法（基于RMM指数）

目的：识别研究时期内的主要MJO活动过程，用于后续分析。使用 RMM指数 判断MJO的活跃期、位相和强度。

方法：

计算RMM振幅和位相：利用每日RMM1和RMM2，计算当天MJO振幅 $A = \sqrt{\text{RMM1}^2 + \text{RMM2}^2}$，以及MJO位相（1-8相，对应RMM1-RMM2在极坐标系的角度区域）。

判定活跃日：设定阈值（通常 $A > 1$）来判断MJO活跃。仅当RMM振幅超过1时认为该日存在显著MJO信号，否则视为非活跃期。

识别连续事件：将连续若干天的活跃日构成一个MJO事件。要求事件持续时间不少于一定天数（例如≥20天），且MJO位相应连续循环（例如从位相2/3开始，依次经过4-6，直到7/8），以确保捕捉到完整的东移过程。

记录事件信息：对每个识别出的MJO事件，记录其开始和结束日期、持续天数、最大振幅，以及主对流活跃的位置（可根据事件期间的主要位相判断大致中心经度，或结合OLR确定精确对流中心位置）。这些信息将用于计算垂直倾斜结构指标和分组分析。

输出：一组MJO事件清单，其中每个事件附有时间范围、振幅、位相路径等属性。这些事件后续将根据ENSO状态进行分类。

ENSO分组规则（基于ONI/Niño3.4指数）

目的：根据ENSO背景将MJO事件分类，以比较厄尔尼诺和拉尼娜条件下MJO垂直倾斜结构的差异。

ENSO指标：采用 NOAA CPC 提供的 ONI指数（Niño3.4区域SST异常的3个月滑动平均）作为ENSO状态判据。每月的ONI数值反映该月所在季节的ENSO位相：

当 ONI ≥ +0.5℃ 时，判定为 El Niño（厄尔尼诺）状态。

当 ONI ≤ -0.5℃ 时，判定为 La Niña（拉尼娜）状态。

-0.5℃ < ONI < +0.5℃ 则视为 中性 状态。

分组方法：

按事件时段归类：对于每个MJO事件，取其发生期间的主要月份或峰值月份的ONI值判定ENSO类别。如果事件跨月，则可使用事件中期的ONI或者分别标记（通常MJO事件持续1-2个月左右，可按事件中点所在季度的ONI）。

分类：将MJO事件分为“El Niño组”、“La Niña组”和“中性组”。如果样本较少，也可仅聚焦对比El Niño和La Niña两组（排除中性），以突出暖、冷相的差异。

样本统计：记录每组中包含的MJO事件数量。确保每组样本量足够进行统计分析（若某组事件过少，可能需要放宽标准或延长年份范围）。

输出：为每个MJO事件新增一个分类标签（El Niño / La Niña / Neutral）。这将用于后续计算倾斜指数时分别取平均以及进行显著性检验。

垂直倾斜结构的定义与指标计算公式

定义：MJO的垂直倾斜结构 (Vertical Tilt Structure, VTS)指的是MJO相关对流和环流在垂直方向上的倾斜特征。经典情况下，MJO对流区表现为随高度向西倾斜：即相对于地面强对流中心，低层上升运动和湿润异常通常出现在其东侧前方，而高层上升运动和云加热出现在其西侧后方。这种西倾垂直结构被认为有助于MJO的东传。

倾斜指标：为定量描述VTS强度，定义 倾斜强度指数 表示高低层上升运动横向错位的程度。具体计算步骤：

确定MJO对流中心经度：对于每个MJO事件，在其成熟阶段找到15°S-15°N平均OLR异常的最小值经度，记作对流中心的位置。

计算低层上升区范围：在MJO对流中心以西（后方），选取低层大气（例如1000–600 hPa平均）垂直速度ω的上升异常区。测定该上升异常相对于对流中心的经度距离 $L_{\text{lower}}$（例如上升异常从对流中心向西延伸的经度范围）。

计算高层上升区范围：同样地，在对流中心以西，测定高层（例如400–200 hPa平均）垂直速度上升异常区相对于对流中心的经度延伸距离 $L_{\text{upper}}$。

倾斜指数计算：定义倾斜指数 $\Delta L$ 为高层与低层上升区经度延伸的差：

Δ
𝐿
=
𝐿
upper
−
𝐿
lower
.
ΔL=L
upper
	​

−L
lower
	​

.

其中 $L_{\text{upper}}$ 和 $L_{\text{lower}}$ 分别表示高层和低层上升异常向西延伸的经度长度。

按照上述定义，$\Delta L > 0$ 表示高层上升运动相对于低层向更西侧倾斜，即存在明显的西倾垂直结构；$\Delta L = 0$ 表示无明显倾斜；负值则意味着异常的反向倾斜（高层偏东倾斜的罕见情况）。倾斜指数越大，表示MJO垂直结构的倾斜程度越强。

实现：在代码中，对于每个MJO事件，读取其OLR和ω场异常，定位对流中心，经纬度转换为相对坐标，然后计算指定高度层平均ω场沿西侧的积分或阈值范围，最终得到 $L_{\text{lower}}$ 和 $L_{\text{upper}}$ 以计算 $\Delta L$。倾斜指数可取事件生命期内的平均值作为该事件的代表值。

主实验：分组倾斜对比与统计检验

目的：比较不同ENSO组别下MJO垂直倾斜指数 $\Delta L$ 的差异，并检验这种差异是否具有统计显著性。

步骤：

倾斜指数计算：对每个已识别的MJO事件，按照上一节方法计算其倾斜指数 $\Delta L$。构建一个包含事件编号、时间段、ENSO分类、$\Delta L$值的表格。

分组统计：将事件按ENSO分类分组，计算每组的平均倾斜指数和标准差。例如，求El Niño组事件的$\Delta L$平均值 $\bar{\Delta L}{EN}$，La Niña组的平均值 $\bar{\Delta L}{LN}$，以及中性组的 $\bar{\Delta L}_{Neutral}$。可以用箱线图或分布图（仅文字分析，无需实际绘图）来概括各组$\Delta L$的分布情况。

显著性检验：采用统计检验方法评估组间差异的显著性。例如使用 Student's t 检验 比较El Niño组和La Niña组的$\Delta L$均值差异是否显著不为零。对于两组样本，可执行双样本t检验（假设方差不一定相等）；对于多组情况，可考虑方差分析 (ANOVA) 后接Tukey事后检验或逐对t检验。

结果判定：根据检验p值判断显著性水平（如α = 0.05）。如果结果表明 $\bar{\Delta L}{EN}$ 显著大于 $\bar{\Delta L}{LN}$（或反之），则支持ENSO状态影响MJO倾斜结构的假设。记录检验统计量和p值，并报告差异的方向（如“El Niño时MJO垂直倾斜更强”或相反）。

输出：以文本和表格形式给出各组倾斜指数的均值、标准误和检验结果。例如：El Niño组平均$\Delta L$=X±σ，La Niña组平均$\Delta L$=Y±σ，差异在95%置信水平上显著。这个主要实验结果将为后续机制分析提供依据。

机制分析模块

目的：探讨导致不同ENSO条件下MJO垂直倾斜结构差异的可能物理机制。通过对比环境场和过程诊断，理解为何ENSO背景会改变MJO的垂直结构倾斜。

本模块将针对以下几个方面进行分析：

低层湿度差异：比较El Niño和La Niña背景下，MJO事件期间对流区及其前后方边界层和低层湿度的分布差异。El Niño时西太平洋暖池增暖，或可导致更强的低层水汽汇聚，使MJO前导的湿润舌更长，从而影响垂直倾斜。通过合成分析低层比湿$q$异常，在MJO对流中心东西两侧的分布，对比不同组别下水汽梯度和丰富程度。

垂直速度结构：对比两组MJO事件的垂直运动(ω)廓线。检查在对流中心前后，高低层垂直上升运动的幅度和位置。尤其关注 500hPa以上高层 和 700hPa以下低层 上升气流的相对位置是否因ENSO而系统偏移。例如，计算El Niño组平均的MJO垂直剖面，查看上升气流峰值在对流中心西侧的距离，与La Niña组比较，印证倾斜指数差异的直接体现。

湿静能平流 (MSE平流)：分析不同ENSO条件下MJO的湿静能输送和收支。湿静能 $h = c_p T + L q + gz$ 综合了热力和水汽作用，其季节内变化可通过平流和加热项诊断。我们将计算MJO事件中的MSE收支方程各项，如水平和垂直平流项：

水平平流：$-u' \frac{\partial h'}{\partial x} - v' \frac{\partial h'}{\partial y}$，表示扰动风将背景湿静能向东/西输送的差异。

垂直平流：$-w' \frac{\partial h'}{\partial p}$，表示上升运动在不同高度输送湿静能的效应。

潜热加热项：由降水凝结释放潜热引起的湿静能变化，可近似用表观湿耗散 $Q_2$ 表示（关系为 $-\frac{Q_2'}{L}$ 对应湿度收支）。

通过诊断上述各项在MJO对流中心前后（东侧与西侧）的不对称性，比较El Niño和La Niña组别。这可以揭示ENSO如何通过改变背景湿静能梯度或对流加热分布，来影响MJO的倾斜结构。例如，若在El Niño背景下，MJO前方（东侧）有更强的边界层湿静能增益（可能因暖池更高的蒸发），则有助于形成更明显的西倾结构。

方法：利用预处理后的再分析数据，针对El Niño和La Niña组分别合成MJO事件发生时的大气场（例如以对流中心为参考坐标取平均）。绘制或计算垂直剖面和水平分布，提取上述关注变量的差值。定量比较例如低层比湿在对流中心东侧增加了多少，高层垂直速度峰值位置相差多少等。

输出：机制分析将给出文字说明和必要的公式计算结果，例如：“在厄尔尼诺背景下，MJO对流前方(东侧)边界层比湿正距平比拉尼娜时高出X g/kg，这导致前导水汽增强，促使更明显的西倾结构形成。” 类似地报告垂直速度峰值高度/经度偏移量，以及MSE平流各项的组间差异。通过这些诊断，阐明ENSO影响MJO垂直倾斜的可能原因。

稳健性检验方法

目的：验证主要结论对方法选择和数据不确定性的敏感性，确保结果稳健可靠。

为测试结果稳健性，本研究设计了多种检验：

指标定义替代：使用不同但相关的指标重新计算倾斜结构，以验证结论一致性。例如，以对流加热廓线替代垂直速度：利用大气加热率或降水廓线定义倾斜指数，并与原$\Delta L$对比。若使用加热场计算的倾斜指数在分组上得到相似差异，说明结果具有鲁棒性。

阈值敏感性：改变MJO事件识别的阈值和标准重新分组。例如将RMM振幅阈值从1提高到1.5，或要求事件持续时间更长/短，重新筛选事件并重复分析。观察分组倾斜差异是否依然存在。如结果保持，则表明结论不依赖于特定阈值选择。

年代及季节检验：将数据样本划分子集，验证各子集结果。一方面，可将研究时期拆分为早期和晚期两段（例如1979-2000与2001-2022）分别重复分析，检查两阶段结论是否一致。另一方面，尝试包含其它季节的MJO事件（如夏季风期间的MJO）进行分析，对比冬季结果，确认ENSO影响并非季节偶然现象。

不同数据源：如可能，采用其它再分析数据（例如NCEP/NCAR或ERA-Interim）或不同的MJO指数（如OMI指数）重复关键步骤。如果不同数据源仍支持类似的ENSO分组差异，说明结果具有普遍性；若出现差异，将讨论资料不确定性带来的影响。

输出：稳健性检验将给出各方案下的对比结果摘要。例如：“使用ERA-Interim数据再分析，El Niño组$\Delta L$仍比La Niña组高约20%，差异显著”，或“提高事件选择阈值后，两组$\Delta L$差异略有减少但方向不变”。这些说明将帮助确认主要发现的可靠程度。

目录结构说明

本项目采用“项目代码在 E:\Projects\ENSO_MJO_Tilt，大数据在 E:\Datas”的组织方式。这样便于版本管理与复现：项目仓库只包含代码、配置与输出摘要；ERA5/OLR 等大体量数据不进入项目目录，通过统一路径配置引用。

A. 项目目录（代码与产出）：E:\Projects\ENSO_MJO_Tilt\

config/：全局配置（必须先看这里）

paths.py：路径配置（例如 DATA_ROOT = E:\Datas，以及 ERA5_ROOT / INDEX_ROOT 等）

params.yml（可选）：实验参数（纬度带、压层范围、阈值、季节等）

src/：源码目录（按实验顺序组织脚本）

00_download_era5.py（可选）：通过 CDS API 下载 ERA5（也可手动下载后放入 E:\Datas\ERA5）

01_preprocess.py：预处理（时间对齐、子域裁剪、去季节/滤波等），输出到 outputs/ 或写回 E:\Datas\ERA5_proc

02_identify_mjo_events.py：基于 RMM 识别 MJO 事件，生成事件表与对流中心信息

03_compute_tilt.py：计算每个事件的垂直倾斜指数（tilt / VTS 指标）

04_analyze_enso_groups.py：ENSO 分组对比（El/La/Neutral）与统计检验（p值、效应量、CI）

05_mechanism.py：机制诊断（如低层湿度前导、ω剖面差异、可选 MSE/moisture budget）

06_robustness.py：稳健性检验（替代定义、阈值敏感性、季节/区域敏感性等）

outputs/：所有结果输出（默认不进版本库）

events/：事件级产物（mjo_events.csv、中心经度、事件QC日志等）

indices/：指数与事件级指标（tilt_by_event.csv、enso_label_by_event.csv 等）

tables/：统计表（均值差、p值、效应量d、bootstrap CI等）

figures/：图件（分组分布图、垂直剖面复合图、机制图、稳健性汇总图等）

logs/（可选）：运行日志、参数快照

docs/：文档目录

README.md：项目总说明（本文件）

notes/（可选）：方法笔记、会议记录等

environment/：环境与依赖

requirements.txt：Python依赖

environment.yml（可选）：conda环境文件

notebooks/（可选）：交互式分析与验证（建议只放探索性Notebook，最终流程应回到 src/）

B. 外部数据目录（大数据存放）：E:\Datas\

建议将外部数据按“ERA5 与 ClimateIndex”分两类，目录结构清晰且固定：

E:\Datas\ClimateIndex/

rmm/：RMM指数（如 rmm.74toRealtime.txt 或整理后的 rmm.csv）

oni/：ONI 或 Niño3.4 指数（oni.csv / nino34.csv）

olr/：OLR逐日网格数据（如 olr_daily.nc）

E:\Datas\ERA5/

raw/：原始下载（建议按变量或产品类型组织）

pressure_level/：pressure-level变量（如 ω、q、u、v、t 等）

single_level/：single-level变量（如 SST、通量、辐射等）

proc/（可选）：预处理后数据（子域裁剪、距平/滤波后的结果，用于加速重复实验）

项目运行时不要求 antigravity “打开” E:\Datas 文件夹；代码通过 config/paths.py 指向外部数据路径即可正常读取。

环境依赖与运行说明

运行环境：Python 3（antigravity兼容）。建议使用pip或conda创建虚拟环境并安装所需依赖。主要依赖库列举如下（requirements.txt样式）：

numpy==1.21.0
pandas==1.3.0
xarray==2023.5.0
netCDF4==1.6.2
scipy==1.9.0       # 用于统计检验
matplotlib==3.4.2  # 绘图（如需要生成图形）
cartopy==0.21.0    # 地图绘制（若需要）
cdsapi==0.5.1      # 若使用ERA5数据下载


请根据需要调整版本。安装依赖后，确保能够导入上述包。

运行说明：

获取数据：运行 src/preprocess_data.py（或首先运行download_data.py下载）。此步骤会从网络或本地获取所有原始数据，并进行预处理，生成后续步骤所需的异常数据文件。

识别MJO事件：运行 src/identify_mjo_events.py。该脚本将读取预处理数据中的RMM指数，按照设定阈值筛选MJO活跃日并组合成事件，输出事件列表文件（例如data/mjo_events.csv），其中包含每个事件的起止日期、持续时间、峰值强度等信息。

计算倾斜指数：运行 src/compute_tilt_index.py，该脚本会遍历mjo_events.csv中每个事件的日期范围，从预处理网格数据中提取对应时空段的OLR和ω场，计算该事件的$\Delta L$值，结果追加到事件列表中（或另存为data/tilt_index.csv）。

主实验分析：运行 src/analyze_groups.py 来执行ENSO分组比较。脚本将载入包含倾斜指数和ENSO标签的事件列表，计算各组平均$\Delta L$并进行统计显著性检验。控制台和日志会输出检验结果，重要结果也保存至results/tables/tilt_group_comparison.txt等文件中。

机制诊断：运行 src/mechanism_analysis.py，对El Niño和La Niña组分别进行合成分析，计算低层湿度、垂直速度剖面、MSE平流项等的组间差异。此脚本可能生成一些图表（如results/figures/vertical_profile_EN_vs_LN.png）和数据文件供检查。

稳健性测试：运行 src/robustness_tests.py 来执行一系列稳健性分析。脚本会根据不同设置重复上述分析流程，并将结果汇总（输出至results/robustness_summary.txt），用于评估结论的可靠性。

查看结果：所有结果汇总在results/目录下。研究者可查阅文本摘要或图形文件，结合科学问题进行解释。如果需要进一步调整分析参数，可修改相应脚本后重新运行上述流程。